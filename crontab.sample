# Renew the proxy certificate every 8 hours
0 0,8,16 * * * /home/fmichel/biomed-support-tools/renew-proxy.sh 2>&1 >> /tmp/monitor-se/renew-proxy.log

#----------------------------------------------------------------------------

# Refresh the SE space availability reports every 30 min
*/30 * * * * /home/fmichel/biomed-support-tools/SE/show-se-space/run-biomed-reports.sh >> /tmp/show-se-space/show-se-space.log

# Refresh the list of service nodes that are not running from the GOCDB (downtime, not in prod, not monitored)
10,40 * * * * . /etc/profile; export VO_SUPPORT_TOOLS=/home/fmichel/biomed-support-tools; $VO_SUPPORT_TOOLS/gocdb-service-status.py --pretty > /tmp/gocdb-service-status-$$.txt; mv /tmp/gocdb-service-status-$$.txt $HOME/public_html/gocdb-service-status.txt

# Generate the current list of biomed SEs used by the se-web-report-generator tool, once every night
0 3 * * * . /etc/profile; /home/fmichel/biomed-support-tools/SE/se-web-report-gen/make-list-se.sh > /tmp/make-list-se.log

#----------------------------------------------------------------------------
# Monitoring and scan of the SEs

# Refresh the list of users from the VOMS every day used by the scan SE)
0 1 * * * . /etc/profile; export VO_SUPPORT_TOOLS=/home/fmichel/biomed-support-tools; $VO_SUPPORT_TOOLS/SE/scan-se/list-users-voms.sh --out /tmp/monitor-se/voms-users.txt > /tmp/monitor-se/voms-users.log

# Scan the full SEs and get the list of heaviest users
0 2 * * 0,3 . /etc/profile; export LFC_HOST=lfc-biomed.in2p3.fr; export VO_SUPPORT_TOOLS=/home/fmichel/biomed-support-tools; $VO_SUPPORT_TOOLS/SE/scan-se/scan-se.sh --voms-users /tmp/monitor-se/voms-users.txt --work-dir /tmp/monitor-se --result-dir $HOME/public_html/scan-full-se --threshold 80 --user-min-used 0 >> /tmp/monitor-se/scan-full-se.log

# Monitoring SEs: get the filling rate of all SEs at 3am every day
10 3 * * * . /etc/profile; export VO_SUPPORT_TOOLS=/home/fmichel/biomed-support-tools; $VO_SUPPORT_TOOLS/SE/show-se-space.py/run-monitor-se.sh >> /tmp/monitor-se/show-se-space.py.log

#----------------------------------------------------------------------------
# Monitoring CEs
10 0,4,8,12,16,20 * * * . /etc/profile; export VO_SUPPORT_TOOLS=/home/fmichel/biomed-support-tools; $VO_SUPPORT_TOOLS/CE/monitor-ce/run-collect-ce-job-status.sh

